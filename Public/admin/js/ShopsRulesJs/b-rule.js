/*pub-1|2012-01-04 20:32:18*//*
 * Copyright ued.taobao.com All rights reserved.
 * header and footer
 * @file b-rule.js
 * @author <a href="mailto:zhanyan@taobao.com">zhanyan</a>  
 * @revision:
 * @version:1-0-2
 */
var G_config;function G_parmsFun(A){G_config=A;YUI().use("k2-validator","node","event-base",function(D){var R=D.Node;var U={"rule-cell":{required:{value:true,message:"\u6b64\u9879\u4e0d\u80fd\u4e3a\u7a7a"},custom:{value:function(X){var Y=/^\s*1\d{10}\s*$/;return Y.test(X)},message:"\u60a8\u8f93\u5165\u7684\u53f7\u7801\u4e0d\u7b26\u5408\u89c4\u8303\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165"}},"rule-minprice":{mask:{value:/^\s*\d+(\.\d{1,2})?\s*$/,message:"\u60a8\u8f93\u5165\u7684\u91d1\u989d\u4e0d\u7b26\u5408\u89c4\u8303\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165"}},"rule-primage":{mask:{value:/^\s*\d+(\.\d{1,2})?\s*$/,message:"\u60a8\u8f93\u5165\u7684\u914d\u9001\u8d39\u4e0d\u7b26\u5408\u89c4\u8303\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165"}},"set-time":{custom:{value:function(X){var Y=/^\s*([1-9][0-9]*|0)\s*$/;return Y.test(X)&&(X>19)&&(X<361)},message:"\u8f93\u5165\u7684\u9884\u7559\u65f6\u95f4\u5fc5\u987b\u572820-360\u4e4b\u5185\u7684\u6574\u6570\u3002"}}};var I=0,O=D.one("#add-time-slice"),M=D.one("#b-times");var N=(G_config.timeRanges?G_config.timeRanges:"00:00~24:00").split(",");if(/null/.test(N[0])){N=["00:00~24:00"]}for(var T=0,S=N.length;T<S;T++){var J=N[T].split("~");if(J[0]!="null"){var P=J[0].split(":"),V=J[1].split(":"),L=parseInt(P[0],10),K=parseInt(V[0],10),C=P[1],B=V[1];H(L,K,C,B,(T==0?true:false))}}D.on("click",function(X){if(this.get("checked")){D.one("#primage-error").setStyle("display","none");D.one("#max-send-price").set("disabled",true)}},"#send-free");D.on("click",function(Z){if(this.get("checked")){D.one("#max-send-price").set("disabled",false);var X=D.one("#rule-minprice").get("value")-0;var Y=D.one("#max-send-price").get("value")-0;if(X>Y){D.one("#primage-error").setStyle("display","inline")}else{D.one("#primage-error").setStyle("display","none")}}},"#send-config");D.on("blur",function(Y){var Z=this.get("value");var X=D.one("#max-send-price");if(Z==""||Z==0){D.one("#send-free").set("checked",true);D.one("#send-config").set("disabled",true);D.one("#max-send-price").set("disabled",true)}else{D.one("#send-config").set("disabled",false);D.one("#max-send-price").set("disabled",false)}},"#rule-primage");D.on("blur",function(Z){if(!D.one("#send-config").get("checked")){return }var X=D.one("#rule-minprice").get("value")-0;var Y=D.one("#max-send-price").get("value")-0;if(X>Y){D.one("#primage-error").setStyle("display","inline")}else{D.one("#primage-error").setStyle("display","none")}},"#rule-minprice,#max-send-price");D.on("click",function(X){X.preventDefault();if(!Q.validate()||D.one("#primage-error").getStyle("display")!="none"){}else{D.all("#b-times select").set("disabled",false);D.one("#rule-form").submit()}},"#rule-btn");var Q=new D.Validator({id:"rule-form",validateOnBlur:true,rules:U});Q.showErrors(G_config["main-errors"]);function F(X,Y){X.append('<option value="'+Y+'">'+Y+"</option>")}function G(b,a,X,Z){b.set("innerHTML","");if(X=="30"){F(b,((a<10)?("0"+a):a)+":30");a++}for(var Y=a;Y<24;Y++){if(Y<10){Y="0"+Y}F(b,Y+":00");F(b,Y+":30")}if(Z=="end"){F(b,"24:00")}}function E(Y,X){Y.on("change",function(){var a=this.get("value").split(":"),Z=parseInt(a[0],10),b=a[1];if(b=="30"){Z++;b="00"}else{b="30"}G(X,Z,b,"end")})}function W(X){X.on("click",function(b){b.preventDefault();if(!confirm("\u786e\u5b9a\u8981\u5220\u9664\u8be5\u65f6\u95f4\u6bb5\u5417\uff1f")){return }this.ancestor("div").remove();O.setStyle("display","");I--;var a=M.all("select");var Y=a.size();a.item(Y-1).set("disabled",false);a.item(Y-2).set("disabled",false);var Z=M.all("a");if(Z.size()){Z.item(Z.size()-1).setStyle("display","")}})}function H(e,b,i,h,Z){var X=R.create("<div>"),Y=R.create("<select style='width:100px;'></select>"),a=R.create("<select style='width:100px;'></select>");Y.set("name","deliveryTime");a.set("name","deliveryTime");X.appendChild(Y);X.appendChild("&nbsp;\u81f3&nbsp;");X.appendChild(a);if(I>0){var g=R.create('<a href="#" class="del-time-slice">&nbsp;<button class="btn btn-mini btn-danger" type="button""><i class="icon-minus"></i> 删除时间段</button></a>');X.appendChild(g);W(g)}M.appendChild(X);var f=M.all("a");if(I>1){f.item(I-2).setStyle("display","none")}if(I>0){var d=M.all("select"),c=I*2;d.item(c-1).set("disabled",true);d.item(c-2).set("disabled",true)}if(Z){G(Y,0,"00","start");Y.set("value",((e<10?"0"+e:e)+":"+i))}else{G(Y,e,i,"start")}G(a,i=="30"?e+1:e,i=="30"?"00":"30","end");a.set("value",((b<10?"0"+b:b)+":"+h));E(Y,a);I++;if(I>3){O.setStyle("display","none")}}O.on("click",function(c){c.preventDefault();var Z=M.all("select"),b=Z.item(Z.size()-1).get("value").split(":"),Y=parseInt(b[0],10),d=b[1];if(Y>23){alert("\u8d85\u51fa\u65f6\u95f4\u6bb5\uff01")}else{if(I>3){alert("\u6700\u591a\u53ef\u8bbe\u7f6e4\u4e2a\u65f6\u95f4\u6bb5\uff01")}else{var a=M.all("div"),f=I*2;Z.item(f-1).set("disabled",true);Z.item(f-2).set("disabled",true);var X=a.item(I-1).all("a");if(X){X.setStyle("display","none")}H(Y,24,d,"00")}}})})};